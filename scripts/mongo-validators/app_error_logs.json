{
  "collMod": "app_error_logs",
  "validator": {
    "$jsonSchema": {
      "bsonType": "object",
      "required": ["at", "level", "service", "env", "message"],
      "properties": {
        "at": { "bsonType": "date" },
        "level": { "enum": ["error", "warn", "info"] },
        "service": { "bsonType": "string" },
        "env": { "enum": ["local", "dev", "staging", "prod"] },
        "orgId": { "bsonType": "string" },
        "actorAuthId": { "bsonType": "string" },
        "route": { "bsonType": "string" },
        "code": { "bsonType": "string" },
        "message": { "bsonType": "string" },
        "stack": { "bsonType": "string" },
        "context": { "bsonType": "object" },
        "requestId": { "bsonType": "string" },
        "resolvedAt": { "bsonType": "date" },
        "tags": { "bsonType": "array", "items": { "bsonType": "string" } }
      },
      "additionalProperties": true
    }
  },
  "validationLevel": "moderate",
  "validationAction": "error",
  "indexes": [
    { "key": { "at": -1 }, "name": "byAtDesc" },
    {
      "key": { "service": 1, "level": 1, "at": -1 },
      "name": "byServiceLevelAt"
    },
    { "key": { "context.patientId": 1, "at": -1 }, "name": "byPatientAt" },
    { "key": { "route": 1, "at": -1 }, "name": "byRouteAt" },
    { "key": { "at": 1 }, "name": "ttlByAt", "expireAfterSeconds": 2592000 }
  ]
}
